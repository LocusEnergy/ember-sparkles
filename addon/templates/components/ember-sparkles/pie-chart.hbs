{{#if d3el}}

  {{#with (hash
    arc=(d3-arc (sub radius 10) 0)
    pie=(d3-pie valueFn=(pipe (d3-get 'value')))
    ) as |constructors|}}

    {{shhh (compute
      (d3-join 'path' (compute constructors.pie data)
        enter=(pipe
          (d3-append 'path')
          (d3-attr 'transform' (i 'translate(${w},${h})' h=centerHeight w=centerWidth))
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-attr 'd' constructors.arc)
          (d3-style 'fill' (pipe (d3-get 'data.key') colorScale))
          (d3-attr 'opacity' 1)
        )
        update=(pipe
          (d3-style 'fill' 'purple')
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-attr 'transform' (i 'translate(${w},${h})' h=centerHeight w=centerWidth))
          (d3-attr 'd' constructors.arc)
          (d3-style 'fill' (pipe (d3-get 'data.key') colorScale))
        )
        exit=(pipe
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-attr 'opacity' 0)
          (d3-remove)
        )
    ) d3el)}}

{{#if with-labels-in-arc}}
    {{shhh (compute
      (d3-join 'text' (compute constructors.pie data)
        enter=(pipe
          (d3-append 'text')
          (d3-attr 'class' 'arcTextStyle')
          (d3-attr 'transform' (ember-sparkles/arc-translate constructors.arc.centroid height=centerHeight width=centerWidth))
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-text keys)
          (d3-attr 'opacity' 1)
        )
        update=(pipe
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-attr 'transform' (ember-sparkles/arc-translate constructors.arc.centroid height=centerHeight width=centerWidth))
        )
        exit=(pipe
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-remove)
          (d3-attr 'opacity' 0)
        )
    ) d3el)}}
{{else}}
{{#with (compute
  (pipe
    (d3-append 'g')
    (d3-attr 'class' 'legend')
    (d3-attr 'opacity' 0)
    (d3-attr 'transform' (i 'translate(${w}, 18)' w=(sub width 80)))
    (d3-attr 'opacity' 1)
  )
  d3el
  ) as |legend|}}

    {{shhh (compute
      (d3-join 'circle' domain
        enter=(pipe
          (d3-append 'circle')
          (d3-style 'fill' colorScale)
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-attr 'transform' (i 'translate(${w}, 18)' w=(sub width 18)))
          (d3-attr 'r' 7)
          (d3-attr 'transform' transformLegend)
        )
        update=(pipe
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-style 'fill' colorScale)
        )
        exit=(pipe
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-attr 'transform' (i 'translate(${w},18)' w=(sub width 18)))
          (d3-remove)
        )
      ) legend
    )}}

    {{shhh (compute (d3-join 'text' domain
        enter=(pipe
          (d3-append 'text')
          (d3-attr 'opacity' 0)
          (d3-attr 'dx' '-3.8em')
          (d3-attr 'dy' '.35em')
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-text (d3-get))
          (d3-attr 'transform' transformLegend)
          (d3-attr 'opacity' 1)
        )
        update=(pipe
          (d3-text (d3-get))
        )
        exit=(pipe
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-remove)
        )
      ) legend
    )}}
        {{!-- This goes in the enter step of circle, it's also kind of broken --}}
  {{/with}}
    {{!-- {{shhh (compute
      (d3-join 'text' (compute constructors.pie data)
        enter=(pipe
          (d3-append 'text')
          (d3-attr 'class' 'arcTextStyle')
          (d3-attr 'transform' (ember-sparkles/arc-translate constructors.arc.centroid height=centerHeight width=centerWidth))
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-text keys)
          (d3-attr 'opacity' 1)
        )
        update=(pipe
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-attr 'transform' (ember-sparkles/arc-translate constructors.arc.centroid height=centerHeight width=centerWidth))
        )
        exit=(pipe
          (if with-transition (d3-transition transition) (d3-noop))
          (d3-remove)
          (d3-attr 'opacity' 0)
        )
    ) d3el)}} --}}
{{/if}}
  {{/with}}
    {{!-- The issue is with this line regarding transformations --}}

{{/if}}
